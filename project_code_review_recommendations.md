# Code Review ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–æ–µ–∫—Ç–∞

–ù–∏–∂–µ —Å–æ–±—Ä–∞–Ω—ã –≤—Å–µ –∑–∞–º–µ—á–∞–Ω–∏—è –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç—É (Next.js 14 + NextAuth + Prisma + OpenAI SDK), —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É.

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ —Ö–æ—Ä–æ—à–æ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:
  - `app/api/*` ‚Äî API —Ä–æ—É—Ç—ã
  - `lib/services/*` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
  - `components/*` ‚Äî UI
- Prisma-—Å—Ö–µ–º–∞ –ª–æ–≥–∏—á–Ω–∞—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è:
  - `User ‚Üí Project ‚Üí Output ‚Üí OutputVersion`
  - –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –¥–ª—è Cache, BrandVoice, History

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü—Ä–æ–≤–µ—Ä–∫–∞ ownership –ø—Ä–æ–µ–∫—Ç–æ–≤ (`project.userId !== userId`)
- –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –ø–ª–∞–Ω–∞–º (—Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞)

### –ü—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
- –•—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- Metadata –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ performance monitor (—Ä–µ–¥–∫–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ MVP ‚Äî —ç—Ç–æ –ø–ª—é—Å)

---

# üö® –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã (–ª—É—á—à–µ –ø–æ–ø—Ä–∞–≤–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å)

## 1. Brand Voice –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ –ø—Ä–æ–º–ø—Ç

–§–∞–π–ª: `lib/services/ai.ts`

–°–µ–π—á–∞—Å –ª–æ–≥–∏–∫–∞ –∏—â–µ—Ç `{sourceContent}` –≤ —É–∂–µ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –ø—Ä–æ–º–ø—Ç–µ:

- `formatPrompt()` –∑–∞–º–µ–Ω—è–µ—Ç –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä
- –ø–æ—Ç–æ–º –ø–æ–∏—Å–∫ `{sourceContent}` –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –µ–≥–æ
- brand voice –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω–µ—Ü –ø—Ä–æ–º–ø—Ç–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
–°–¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä `{brandVoice}` –≤ —à–∞–±–ª–æ–Ω–∞—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å –µ–≥–æ —è–≤–Ω–æ.

–ò–ª–∏ –≤–Ω–µ–¥—Ä—è—Ç—å brand voice –¥–æ `formatPrompt()`.

---

## 2. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–µ–æ—á–∏—â–µ–Ω–Ω—ã–π (unsanitized) –∫–æ–Ω—Ç–µ–Ω—Ç

–í—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ –≤ –ë–î `sanitizedContent`, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–¥–µ–ª–∏.

### –ü—Ä–æ–±–ª–µ–º–∞
UI –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–∞–∑–Ω—ã–π —Ç–µ–∫—Å—Ç.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
–í—Å–µ–≥–¥–∞:
- –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å
- —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å
- –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏–º–µ–Ω–Ω–æ –æ—á–∏—â–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é.

---

## 3. Promise + –æ–±—â–∏–π –º–∞—Å—Å–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

```ts
platforms.map(async () => { results.push(...) })
```

### –ü—Ä–æ–±–ª–µ–º—ã
- –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫
- –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ race conditions

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```ts
const results = await Promise.all(...)
```

---

## 4. Rate limit —Ç–æ–ª—å–∫–æ in-memory

–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ª–æ–∫–∞–ª–∫–∏, –Ω–æ:
- –Ω–∞ serverless –ª–æ–º–∞–µ—Ç—Å—è
- –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –æ–±–æ–π—Ç–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏)
- Redis (Upstash)
- –∏–ª–∏ —É—Å–∏–ª–∏—Ç—å —á–µ—Ä–µ–∑ –∫–≤–æ—Ç—ã –≤ –ë–î

---

# ‚ö° –£–ª—É—á—à–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞

## 5. OpenAI —Å–ª–æ–π –ª—É—á—à–µ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å

–°–µ–π—á–∞—Å:
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `chat.completions`
- –º–æ–¥–µ–ª–∏ —Ö–∞—Ä–¥–∫–æ–¥—è—Ç—Å—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
–°–¥–µ–ª–∞—Ç—å –µ–¥–∏–Ω—ã–π AI-adapter:
- —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏
- —É–¥–æ–±–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ streaming
- structured outputs –≤ –±—É–¥—É—â–µ–º

---

## 6. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å API-–æ—à–∏–±–∫–∏

–°–µ–π—á–∞—Å —Å–º–µ—à–∞–Ω—ã:
- —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã
- JSON error responses

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
–í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å JSON:

```json
{ "error": "Unauthorized" }
```

---

## 7. Cache –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏

TTL –µ—Å—Ç—å, –Ω–æ –æ—á–∏—Å—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- cron-–∑–∞–¥–∞—á–∞
- –∏–ª–∏ –ª–µ–Ω–∏–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –±–∞—Ç—á–∞–º–∏ –ø—Ä–∏ –Ω–æ–≤—ã—Ö –≤—Å—Ç–∞–≤–∫–∞—Ö

---

## 8. –£—Å–∏–ª–∏—Ç—å —Ç–µ—Å—Ç—ã

–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ —Å—Ç–æ–∏—Ç –ø–æ–∫—Ä—ã—Ç—å:

- Zod —Å—Ö–µ–º—ã
- generate API route:
  - unauthorized
  - —á—É–∂–æ–π projectId
  - –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
  - –Ω–µ–≤–µ—Ä–Ω—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

---

# üìå –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

–ü—Ä–æ–µ–∫—Ç –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ —Å–∏–ª—å–Ω—ã–π MVP —Å –ø—Ä–æ–¥—É–º–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:
‚úÖ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚úÖ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚úÖ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
‚úÖ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è –ª–æ–≥–∏–∫–∞

### –ì–ª–∞–≤–Ω—ã–µ —Ä–∏—Å–∫–∏ —Å–µ–π—á–∞—Å:
‚ùó –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è brand voice
‚ùó —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É UI –∏ –ë–î

–ü–æ—Å–ª–µ —Ñ–∏–∫—Å–∞ —ç—Ç–∏—Ö –º–æ–º–µ–Ω—Ç–æ–≤ –∫–æ–¥ —É–∂–µ –±–ª–∏–∑–æ–∫ –∫ production-—É—Ä–æ–≤–Ω—é –¥–ª—è SaaS MVP.

---

–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è ‚Äî –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å –ø–∞—Ç—á–∞–º–∏ (diff) –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.

