# План: интерфейс под тарифы «Текст» / «Текст + Аудио»

Доработка интерфейса: где показывать план подписки, как вести пользователя на страницу генерации, какие страницы изменить или дополнить.

---

## 1. Что уже сделано по плану (Этап 7)

По **PLAN_two_tier_subscription.md** (Этап 7. UX: выбор тарифа и типа источника) реализовано **только на одной странице**:

- **Страница генерации** `app/(dashboard)/projects/[id]/generate/page.tsx`:
  - запрос `/api/subscription/features`;
  - бейдж тарифа («Текст» / «Текст + Аудио») рядом с заголовком «Generate Content»;
  - блок «Загрузить аудио» (только при `canUseAudio`);
  - блок «Загрузить .txt» (только при тарифе «Текст»);
  - предупреждение PII после генерации.

В плане также было: *«В настройках подписки или при создании проекта: явное отображение тарифа»*. Это **не сделано**: план нигде не показывается — ни при создании проекта, ни в настройках, ни в шапке/сайдбаре.

---

## 2. Текущий интерфейс (маршруты и пробелы)

| Маршрут | Содержимое | План / подписка | Ссылка на генерацию |
|--------|------------|------------------|----------------------|
| `/` | Лендинг | нет | нет |
| `/login`, `/signup` | Вход/регистрация | нет | нет |
| `/dashboard` | Дашборд | нет | нет |
| `/projects` | Список проектов | нет | нет (только клик по проекту) |
| `/projects/new` | Форма: название, исходный текст, платформы | **нет** | **нет** (после сабмита → `/projects`) |
| `/projects/[id]` | Детали проекта, исходный текст, outputs | **нет** | Есть кнопки «Regenerate» и «Generate Content» |
| `/projects/[id]/generate` | Генерация по платформам | **есть** (бейдж, аудио, .txt) | — |
| `/projects/[id]/edit` | Редактирование проекта | нет | нет |
| `/settings` | Заглушка «Coming soon» | **нет** | нет |

**Вывод:** пользователь, который идёт по сценарию «New Project → заполнил форму → сохранил», остаётся на списке проектов и не видит ни плана, ни страницы с загрузкой аудио/.txt. Чтобы увидеть новый интерфейс, нужно зайти в проект и нажать «Generate Content» или «Regenerate» — это неочевидно.

---

## 3. Цели доработки

1. **План подписки виден** в ключевых местах: при создании проекта и/или в настройках/шапке.
2. **После создания проекта** пользователь попадает на страницу генерации (или явно ведётся туда).
3. **На странице проекта** видно и план, и явный призыв «Сгенерировать контент» (переход на generate).
4. **Настройки** содержат блок подписки (план, лимиты), а не только заглушку.

---

## 4. Варианты: новые страницы vs правки существующих

**Рекомендация:** в основном править существующие страницы и один раз расширить Settings. Отдельная «страница подписки» не обязательна, если блок в Settings достаточен.

- **Не создавать** отдельный маршрут типа `/subscription` или `/plan`, если достаточно раздела в Settings.
- **Создать** имеет смысл только если позже появятся оплата/смена плана (тогда можно добавить, например, `/settings/subscription` или `/subscription`).

---

## 5. План изменений по страницам

### 5.1. Общее: отображение плана (компонент + данные)

- **Сделать переиспользуемый компонент** «бейдж плана» (например `PlanBadge`), который:
  - запрашивает `GET /api/subscription/features` (или получает данные с сервера/провайдера);
  - рендерит «Текст» или «Текст + Аудио» (с иконкой при необходимости).
- **Состояния:** загрузка — показывать скелетон или ничего, не блокировать страницу; ошибка (401, сеть) — не показывать бейдж или «—», не падать.
- **Доступность:** у бейджа задать `aria-label` / `title`, чтобы скринридеры понимали смысл («Тариф: Текст» / «Тариф: Текст + Аудио»).
- Использовать его на: Header или Sidebar, `/projects/new`, `/projects/[id]`, при необходимости — на `/projects`, `/dashboard`, `/projects/[id]/edit`.

**Файлы:** новый `components/subscription/plan-badge.tsx` (или в `components/ui/`), при необходимости обёртка/провайдер для данных подписки.

---

### 5.2. Header или Sidebar

- **Модификация:** добавить отображение плана (бейдж) в шапку или сайдбар дашборда, чтобы тариф был виден на всех страницах после входа.
- **Файлы:** `components/layout/header.tsx` или `components/layout/sidebar.tsx` (один из них, чтобы не дублировать).

---

### 5.3. Страница «Новый проект» (`/projects/new`)

- **Модификация:**
  - Показать бейдж плана (Текст / Текст + Аудио) рядом с заголовком «Create New Project» (или над формой).
  - После успешного создания проекта выполнять редирект на `/projects/[id]/generate` вместо `/projects`, чтобы пользователь сразу попадал на страницу с загрузкой аудио/.txt и генерацией.
- **Файлы:**
  - `app/(dashboard)/projects/new/page.tsx` — добавить `PlanBadge`.
  - `components/projects/project-form.tsx` — в колбэке после успешного POST передавать `projectId` и редиректить на `/projects/[id]/generate` (при создании, не при редактировании).

---

### 5.4. Страница проекта (`/projects/[id]`)

- **Модификация:**
  - Показать бейдж плана рядом с заголовком «Project Details» (или в шапке карточки).
  - Сделать кнопку перехода на генерацию более заметной: например, основная кнопка «Generate Content» (или «Сгенерировать контент»), ведущая на `/projects/[id]/generate`, а «Regenerate» оставить вторичной или рядом.
- **Файлы:** `app/(dashboard)/projects/[id]/page.tsx`.

---

### 5.5. Страница настроек (`/settings`)

- **Модификация (расширение существующей страницы):**
  - Заменить заглушку «Coming soon» на реальный контент.
  - Добавить секцию «Подписка» / «Plan»:
    - текущий тариф (Текст / Текст + Аудио) и имя плана (Free / Pro / Enterprise);
    - **общие лимиты плана:** макс. проектов, макс. символов контента (из `PLAN_LIMITS` или ответа API);
    - при тарифе «Текст + Аудио» — лимиты аудио: использовано X из Y минут, макс. размер файла (MB); данные из `/api/subscription/features`.
- **Файлы:** `app/(dashboard)/settings/page.tsx`. При необходимости — клиентский компонент для блока подписки (запрос к API, отображение лимитов). Лимиты проектов/символов можно брать из `lib/constants/plans.ts` (PLAN_LIMITS) по текущему плану.

---

### 5.6. Список проектов (`/projects`)

- **Бейдж плана (опционально):** в шапке страницы (рядом с «Projects») показать тот же бейдж плана.
- **Быстрый переход на генерацию:** в списке уже есть пункт «Generate» в выпадающем меню карточки (⋯ → Generate). Сделать его заметнее: например, основная кнопка «Generate» на карточке или иконка «Play»/«Generate» рядом с заголовком, ведущая на `/projects/[id]/generate`, чтобы не искать в меню.
- **Файлы:** `app/(dashboard)/projects/page.tsx` (бейдж), `components/projects/projects-list-client.tsx` (кнопка/ссылка Generate на карточке).

---

### 5.7. Дашборд (`/dashboard`)

- **Модификация:**
  - В шапке (рядом с «Dashboard» или в блоке с кнопками) показать бейдж плана.
  - В блоке «Recent Projects» у каждого проекта добавить явную ссылку «Generate» (на `/projects/[id]/generate`), чтобы с дашборда можно было сразу перейти к генерации, не открывая страницу проекта.
- **Файлы:** `app/(dashboard)/dashboard/page.tsx` (бейдж — через клиентский компонент или серверную передачу данных подписки); для ссылки Generate в Recent Projects — разметка в том же файле (Link рядом с названием проекта).

---

### 5.8. Страница редактирования проекта (`/projects/[id]/edit`)

- **Модификация:**
  - Показать бейдж плана рядом с заголовком «Edit Project» (или над формой).
  - Добавить кнопку/ссылку «Generate Content» (на `/projects/[id]/generate`), чтобы после сохранения изменений пользователь мог сразу перейти к генерации.
- **Файлы:** `app/(dashboard)/projects/[id]/edit/page.tsx`.

---

### 5.9. Язык и консистентность надписей

- На странице генерации уже смешаны русские («Текст», «Текст + Аудио», «Загрузить аудио») и английские («Generate Content», «Source Content») надписи. При добавлении новых элементов (бейдж, кнопки, Settings) **сохранять тот же стиль** или явно выбрать один язык для блока подписки (например, везде RU для тарифа и лимитов). Отдельный i18n в этот план не вводить.

---

## 6. Порядок внедрения

1. Компонент отображения плана (`PlanBadge` с учётом загрузки/ошибки и aria-label).
2. Header или Sidebar — добавить бейдж плана.
3. `/projects/new` — бейдж + редирект после создания на `/projects/[id]/generate`.
4. `/projects/[id]` — бейдж + явная основная кнопка «Generate Content».
5. `/settings` — секция подписки (план + общие лимиты + лимиты аудио при text_audio).
6. `/dashboard` — бейдж + ссылка «Generate» у каждого проекта в Recent Projects.
7. `/projects/[id]/edit` — бейдж + ссылка «Generate Content».
8. `/projects` — по желанию бейдж в шапке; сделать «Generate» на карточках заметнее (кнопка или иконка).

---

## 7. Что не меняем

- Логику и контент страницы `/projects/[id]/generate` (там уже всё по плану).
- API `/api/subscription/features` — используем как есть (при необходимости расширить ответ полями maxProjects, maxCharactersPerContent из плана — опционально).
- Маршруты и права доступа — без изменений, только добавление UI и редиректа.

---

## 8. Итог после выполнения

- План подписки виден: в Header/Sidebar, на /projects/new, /projects/[id], /projects/[id]/edit, /dashboard, /projects, /settings.
- После создания проекта — редирект на `/projects/[id]/generate`.
- Явный призыв к генерации: основная кнопка на странице проекта, ссылка «Generate» на дашборде и в списке проектов (более заметная), ссылка на странице редактирования.
- В настройках — блок подписки с тарифом и всеми лимитами (проекты, символы, аудио при text_audio).
- Состояния загрузки/ошибки у PlanBadge не ломают страницу; доступность учтена.
